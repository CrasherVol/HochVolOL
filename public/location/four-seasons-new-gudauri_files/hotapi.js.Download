/*
Hotels API plugin by Is Open Source
Ioannis Sannos
http://www.isopensource.com
*/
function hotapiValEmail(str) { if (str == '') { return false; } var emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/; if (str.search(emailPattern) == -1) { return false; } return true; }
function hotapitrim(str) { str = str.replace(/^\s+/, ''); for (var i = str.length - 1; i >= 0; i--) { if (/\S/.test(str.charAt(i))) { str = str.substring(0, i + 1); break; } } return str; }
function addHotelApiCode() { var apiid = hotapitrim(document.getElementById('hapi_apiid').value); if (apiid == '') { return false; } var apikey = hotapitrim(document.getElementById('hapi_apikey').value); if (apikey == '') { return false; } var pcode = '{hotelapi}'+apiid+','+apikey+'{/hotelapi}'; addPluginCode(pcode); }
function hotapiMessageFader(elemid, msg, class_name_show, class_name_hide) { if (!document.getElementById(elemid)) { return; } document.getElementById(elemid).innerHTML = msg; document.getElementById(elemid).className = class_name_show; setTimeout(function(){ document.getElementById(elemid).innerHTML = ''; document.getElementById(elemid).className = class_name_hide; },3000); }
function hotapiContact() {
	var rname = hotapitrim(document.getElementById('hapifname').value); var remail = document.getElementById('hapifemail').value; var rmsg = hotapitrim(document.getElementById('hapifmsg').value); var apiid = document.getElementById('hotapi_apiid').value; var alert_msg = document.getElementById('hotapi_lng_cfillall').innerHTML; var wait_msg = document.getElementById('hotapi_lng_cwait').innerHTML; if (rname == '') { hotapiMessageFader('hotapi_response', alert_msg, 'hotapi_warn', 'hotapi_invisible'); return false; } if (hotapiValEmail(remail) == false) { hotapiMessageFader('hotapi_response', alert_msg, 'hotapi_warn', 'hotapi_invisible'); return false; } if (rmsg == '') { hotapiMessageFader('hotapi_response', alert_msg, 'hotapi_warn', 'hotapi_invisible'); return false; } document.getElementById('hotapi_response').innerHTML = wait_msg; document.getElementById('hotapi_response').className = 'hotapi_wait';
	if (document.getElementById('hotapi_clang').value != '') { var eurl = document.getElementById('hotapi_csrv').value+'/inner.php/'+document.getElementById('hotapi_clang').value+'/reservations/hotels/api/contact'; } else { var eurl = document.getElementById('hotapi_csrv').value+'/inner.php/reservations/hotels/api/contact'; }
	var rnd = Math.floor((Math.random()*100)+1); var edata = { 'apiid':apiid, 'type': 'JSON', 'fullname':rname, 'email':remail, 'message':rmsg, 'ts':document.getElementById('hotapi_cts').value, 'currency':document.getElementById('hotapi_ccur').value, 'enc':document.getElementById('hotapi_cenc').value, 'rnd':rnd };
	var successfunc = function(xreply) {
    	try { var jsonObj = JSON.parse(xreply); } catch (e) { hotapiMessageFader('hotapi_response', 'Could not send email!', 'hotapi_warn', 'hotapi_invisible'); return false; }
		if (parseInt(jsonObj.error, 10) == 1) {
			if (jsonObj.message != '') { hotapiMessageFader('hotapi_response', jsonObj.message, 'hotapi_warn', 'hotapi_invisible'); } else { hotapiMessageFader('hotapi_response', 'Could not send email!', 'hotapi_warn', 'hotapi_invisible'); } return false;
		} else {
			document.getElementById('hapifname').value = ''; document.getElementById('hapifemail').value = ''; document.getElementById('hapifmsg').value = ''; if (jsonObj.message != '') { hotapiMessageFader('hotapi_response', jsonObj.message, 'hotapi_success', 'hotapi_invisible'); } else { hotapiMessageFader('hotapi_response', 'Your message was sent successfully. Thanks for contact us.', 'hotapi_success', 'hotapi_invisible'); }
		}
	};
	var errorfunc = function (XMLHttpRequest, textStatus, errorThrown) { hotapiMessageFader('hotapi_response', errorThrown, 'hotapi_warn', 'hotapi_invisible'); }
	elxAjax('POST', eurl, edata, null, null, successfunc, errorfunc);
}
function hotapiCheckRooms() {
	var rcheckin = hotapitrim(document.getElementById('hapicheckin').value); var rcheckout = hotapitrim(document.getElementById('hapicheckout').value); var apiid = document.getElementById('hotapi_apiid2').value; var alert_msg = document.getElementById('hotapi_lng_fillall').innerHTML; var wait_msg = document.getElementById('hotapi_lng_wait').innerHTML; if (rcheckin == '') { hotapiMessageFader('hotapi_cresponse', alert_msg, 'hotapi_warn', 'hotapi_invisible'); return false; } if (rcheckout == '') { hotapiMessageFader('hotapi_cresponse', alert_msg, 'hotapi_warn', 'hotapi_invisible'); return false; } var numrooms = document.getElementById('numroomshapi').options[document.getElementById('numroomshapi').selectedIndex].value; numrooms = parseInt(numrooms, 10); if (numrooms < 1) { numrooms = 1; } var adults_arr = new Array(); var children_arr = new Array();
	for (var i = 1; i < 6; i++) { var x = i - 1; var adsel = 'room'+i+'adultshapi'; var chsel = 'room'+i+'childrenhapi'; if (!document.getElementById(adsel)) { adults_arr[x] = 0; children_arr[x] = 0; continue; } var adults = document.getElementById(adsel).options[document.getElementById(adsel).selectedIndex].value; adults = parseInt(adults, 10); if (adults < 1) { adults = 1; } var children = document.getElementById(chsel).options[document.getElementById(chsel).selectedIndex].value; children = parseInt(children, 10); if (children < 0) { children = 0; } adults_arr[x] = adults; children_arr[x] = children; }
	var artlink = document.getElementById('hotapi_cartlink').value; var mobile = document.getElementById('hotapi_ismobile').value; mobile = parseInt(mobile, 10); document.getElementById('hotapi_cresponse').innerHTML = wait_msg; document.getElementById('hotapi_cresponse').className = 'hotapi_wait'; var eurl = document.getElementById('hotapi_cu').value; var rnd = Math.floor((Math.random()*100)+1);
	var edata = {'apiid':apiid, 'task':'checkavrooms', 'f':'components/com_content/plugins/hotelapi/ajax.php', 'artlink':artlink, 'lang':document.getElementById('hotapi_clang2').value, 'srv':document.getElementById('hotapi_srvc2').value, 'mobile':mobile, 'checkin':rcheckin, 'checkout':rcheckout, 'numrooms':numrooms, 'room1adults':adults_arr[0], 'room1children':children_arr[0], 'room2adults':adults_arr[1], 'room2children':children_arr[1], 'room3adults':adults_arr[2], 'room3children':children_arr[2], 'room4adults':adults_arr[3], 'room4children':children_arr[3], 'room5adults':adults_arr[4], 'room5children':children_arr[4], 'ts':document.getElementById('hotapi_cts2').value, 'currency':document.getElementById('hotapi_ccur2').value, 'enc':document.getElementById('hotapi_cenc2').value, 'rnd':rnd };
	var successfunc = function(xreply) { document.getElementById('hotapi_cresponse').className = 'hotapi_invisible'; document.getElementById('hotapi_cresponse').innerHTML = ''; if (document.getElementById('hotapi_block_gallery')) { document.getElementById('hotapi_block_gallery').className = 'hotapi_invisible'; document.getElementById('hotapi_block_gallery').innerHTML = ''; } if (document.getElementById('hotapi_block_desc')) { document.getElementById('hotapi_block_desc').className = 'hotapi_invisible'; document.getElementById('hotapi_block_desc').innerHTML = ''; } if (document.getElementById('hotapi_block_rooms')) { document.getElementById('hotapi_block_rooms').className = 'hotapi_invisible'; document.getElementById('hotapi_block_rooms').innerHTML = ''; } document.getElementById('hotapi_taskresp').innerHTML = xreply; };
	var errorfunc = function (XMLHttpRequest, textStatus, errorThrown) { hotapiMessageFader('hotapi_cresponse', errorThrown, 'hotapi_warn', 'hotapi_invisible'); }
	elxAjax('POST', eurl, edata, null, null, successfunc, errorfunc);
}
function setHapiRoomsNumber() { if (!document.getElementById('numroomshapi')) { return; } var sObj = document.getElementById('numroomshapi'); var numrooms = sObj.options[sObj.selectedIndex].value; numrooms = parseInt(numrooms, 10); if (numrooms < 1) { numrooms = 1; } for (var i = 1; i < 6; i++) { var rowfield = 'room'+i+'guestinfohapi'; if (!document.getElementById(rowfield)) { continue; } if (i > numrooms) { document.getElementById(rowfield).className = 'hotapi_invisible'; } else { document.getElementById(rowfield).className = ''; } } calcHapiRoomsTotal(); }
function calcHapiRoomsTotal() {
	if (!document.getElementById('numroomshapi')) { return; } if (!document.getElementById('lngpickhapi')) { return; } if (!document.getElementById('guestinfohapi')) { return; } var sObj = document.getElementById('numroomshapi'); var numrooms = sObj.options[sObj.selectedIndex].value; numrooms = parseInt(numrooms, 10); if (numrooms < 1) { numrooms = 1; } var total_adults = 0, total_children = 0, sum = 0, sumtxt = '';
	for (var i = 1; i < 6; i++) { if (i > numrooms) { break; } var adfield = 'room'+i+'adultshapi'; var chfield = 'room'+i+'childrenhapi'; var sum = document.getElementById(adfield).options[document.getElementById(adfield).selectedIndex].value; sum = parseInt(sum, 10); total_adults += sum; var sum = document.getElementById(chfield).options[document.getElementById(chfield).selectedIndex].value; sum = parseInt(sum, 10); total_children += sum; }
	var lngarr = document.getElementById('lngpickhapi').innerHTML.split(','); sumtxt += (numrooms == 1) ? '1 '+lngarr[0] : numrooms+ ' '+lngarr[1]; sumtxt += ', '; sumtxt += (total_adults == 1) ? '1 '+lngarr[2] : total_adults+ ' '+lngarr[3]; if (total_children > 0) { sumtxt += ', '; sumtxt += (total_children == 1) ? '1 '+lngarr[4] : total_children+ ' '+lngarr[5]; } document.getElementById('guestinfohapi').innerHTML = sumtxt;
}
function setHapiBookRooms(rid, cursymb) {
	var numfield = 'booknr'+rid; var butfield = 'bookpickedsub'+rid; if (!document.getElementById(numfield)) { return; } var sObj = document.getElementById(numfield); var numrooms = sObj.options[sObj.selectedIndex].value; numrooms = parseInt(numrooms, 10); if (numrooms < 0) { numrooms = 0; }
	for (var i = 1; i < 6; i++) { var rowfield = 'bookoption'+rid+'_'+i; if (!document.getElementById(rowfield)) { continue; } if (i > numrooms) { document.getElementById(rowfield).className = 'hotapi_bookoption_off'; } else { document.getElementById(rowfield).className = 'hotapi_bookoption_on'; } }
	if (numrooms == 0) { document.getElementById(butfield).disabled = true; var pricefield = 'bookprice'+rid; document.getElementById(pricefield).innerHTML = ''; } else { document.getElementById(butfield).disabled = false; calcHapiBookRoomTotal(rid, cursymb); }
}
function calcHapiBookRoomTotal(rid, cursymb) {
	var numfield = 'booknr'+rid; var chargefield = 'bookct'+rid; var unitafield = 'bookua'+rid; var unitcfield = 'bookuc'+rid; var pricefield = 'bookprice'+rid; if (!document.getElementById(numfield)) { return; } var sObj = document.getElementById(numfield); var numrooms = sObj.options[sObj.selectedIndex].value; numrooms = parseInt(numrooms, 10); if (numrooms < 1) { return; } var chargetype = document.getElementById(chargefield).value; chargetype = parseInt(chargetype, 10); var unitadult = document.getElementById(unitafield).value; var unitchild = document.getElementById(unitcfield).value; if (chargetype == 0) { var newprice = unitadult * numrooms; document.getElementById(pricefield).innerHTML = newprice.toFixed(2)+' '+cursymb; return; } var newprice = 0;
	for (var i = 1; i < 6; i++) { if (i > numrooms) { break; } var adfield = 'bookad'+rid+'_'+i; var chfield = 'bookch'+rid+'_'+i; var numad = document.getElementById(adfield).options[document.getElementById(adfield).selectedIndex].value; numad = parseInt(numad, 10); var numch = document.getElementById(chfield).options[document.getElementById(chfield).selectedIndex].value; numch = parseInt(numch, 10); newprice += document.getElementById(unitafield).value * numad; newprice += document.getElementById(unitcfield).value * numch; } document.getElementById(pricefield).innerHTML = newprice.toFixed(2)+' '+cursymb;
}
function hapicalcservices(asidsstr, decs) {
	if (asidsstr == '') { return false; } var asids = asidsstr.split(','); var q = 0; var am = 0.00; var total = 0.00;
	if (asids instanceof Array) {
		decs = parseInt(decs); for (var i in asids) { asid = parseInt(asids[i]); if (asid > 0) { if (document.getElementById('hapiservices'+asid)) { q = document.getElementById('hapiservices'+asid).options[document.getElementById('hapiservices'+asid).selectedIndex].value; q = parseInt(q); if (document.getElementById('userviceprice'+asid)) { am = document.getElementById('userviceprice'+asid).value; total += parseFloat(am) * q; } } } }
		document.getElementById('servicestotal').innerHTML = total.toFixed(decs);
		if (document.getElementById('hapi_roomstotal')) { var roomstotal = document.getElementById('hapi_roomstotal').value; var restotal = parseFloat(roomstotal); restotal += total; document.getElementById('hapi_restotal').innerHTML = restotal.toFixed(decs); if (document.getElementById('hapi_feepcnt')) { var pcnt = document.getElementById('hapi_feepcnt').value; pcnt = parseInt(pcnt, 10); if (pcnt > 0) { var feetotal = (restotal * pcnt) / 100; document.getElementById('hapi_feetotal').innerHTML = feetotal.toFixed(decs); } } }
	} else {
		return false;
	}
}
function hapiLightRequired(fieldname) { var markname = 'req_'+fieldname; if (!document.getElementById(markname)) { return; } document.getElementById(markname).className = 'hapi_reqmark_show'; setTimeout(function(){ document.getElementById(markname).className = 'hapi_reqmark'; },3000); }
function hapisubmitBook(hasTerms) {
	hasTerms = parseInt(hasTerms, 10); var form = document.getElementById('hapibookfm'); if (hotapitrim(document.getElementById('ofirstname855').value) == '') { hapiLightRequired('ofirstname855'); document.getElementById('ofirstname855').focus(); return false; } if (hotapitrim(document.getElementById('olastname855').value) == '') { hapiLightRequired('olastname855'); document.getElementById('olastname855').focus(); return false; } if (hotapitrim(document.getElementById('ocity855').value) == '') { hapiLightRequired('ocity855'); document.getElementById('ocity855').focus(); return false; } if (hotapitrim(document.getElementById('oaddress855').value) == '') { hapiLightRequired('oaddress855'); document.getElementById('oaddress855').focus(); return false; }
	if (hotapitrim(document.getElementById('oemail855').value) == '') { hapiLightRequired('oemail855'); document.getElementById('oemail855').focus(); return false; } if (!hotapiValEmail(document.getElementById('oemail855').value)) { hapiLightRequired('oemail855'); document.getElementById('oemail855').focus(); return false; } if (hotapitrim(document.getElementById('ophone855').value) == '') { hapiLightRequired('ophone855'); document.getElementById('ophone855').focus(); return false; } if (hasTerms == 1) { if (document.getElementById('terms855').checked == false) { var prompttxt = document.getElementById('hapitermsprompt').innerHTML; alert(prompttxt); return false; } } document.getElementById('hapibookbtn').textContent = document.getElementById('hapi_book_wait').innerHTML; document.getElementById('hapibookbtn').disabled = true; try { form.onsubmit(); } catch(e){} form.submit();
}
